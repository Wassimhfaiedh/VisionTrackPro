<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Meta Information -->
    <meta charset="UTF-8"> <!-- Set character encoding to UTF-8 -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- Ensure responsive design -->
    <title>VisionTrack Pro - Advanced Object Detection Dashboard</title> <!-- Page title -->

    <!-- External Stylesheets -->
    <!-- Import Google Fonts: Poppins and Inter for typography -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <!-- Import Animate.css for animations -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    <!-- Import Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <!-- External Scripts -->
    <!-- Import jsPDF for PDF generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <!-- Import jsPDF AutoTable plugin for table generation in PDFs -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>

    <!-- Internal Styles -->
    <style>
        /* Define CSS custom properties (variables) for consistent theming */
        :root {
            --primary: #7B3FE4; /* Primary color for branding */
            --primary-dark: #5B2AB8; /* Darker primary shade */
            --primary-light: #A76EF5; /* Lighter primary shade */
            --secondary: #00D4B4; /* Secondary color for buttons */
            --secondary-dark: #00A896; /* Darker secondary shade */
            --accent: #FF6B81; /* Accent color for alerts */
            --accent-dark: #E84862; /* Darker accent shade */
            --dark: #1E1E2E; /* Dark background color */
            --darker: #12121A; /* Darker background shade */
            --light: #F8FAFC; /* Light background color */
            --lighter: #FFFFFF; /* White color */
            --gray: #6B7280; /* Gray for text */
            --gray-light: #E5E7EB; /* Light gray for backgrounds */
            --success: #34D399; /* Success color */
            --warning: #FBBF24; /* Warning color */
            --glass: rgba(255, 255, 255, 0.1); /* Glass effect background */
            --glass-border: rgba(255, 255, 255, 0.15); /* Glass effect border */
        }

        /* Reset default styles for consistency */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        /* Body Styling */
        body {
            font-family: 'Poppins', sans-serif; /* Default font */
            background: linear-gradient(145deg, var(--dark) 0%, var(--darker) 100%); /* Gradient background */
            color: var(--lighter); /* Text color */
            margin: 0;
            padding: 0;
            min-height: 100vh; /* Full viewport height */
            overflow-x: hidden; /* Prevent horizontal scroll */
        }

        /* Main Container */
        .container {
            max-width: 1920px; /* Maximum width for large screens */
            margin: 0 auto;
            padding: 2.5rem; /* Padding for content */
        }

        /* Header Section */
        .header {
            background: linear-gradient(135deg, rgba(30, 30, 46, 0.9) 0%, rgba(18, 18, 26, 0.95) 100%); /* Gradient background */
            padding: 2rem;
            border-radius: 20px;
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.3); /* Shadow effect */
            margin-bottom: 3rem;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: slideInDown 1s ease-out; /* Animation for header appearance */
            backdrop-filter: blur(12px); /* Glass effect */
            border: 1px solid var(--glass-border);
            position: relative;
            overflow: hidden;
        }

        /* Header Background Effect */
        .header::before {
            content: '';
            position: absolute;
            top: -60%;
            left: -60%;
            width: 220%;
            height: 220%;
            background: radial-gradient(circle, rgba(123, 63, 228, 0.15) 0%, transparent 60%); /* Radial glow effect */
            animation: rotateGlow 25s linear infinite;
            z-index: -1;
        }

        /* Logo Container */
        .logo-container {
            display: flex;
            align-items: center;
            gap: 1.2rem; /* Space between logo and text */
        }

        /* Logo Styling */
        .logo {
            width: 56px;
            height: 56px;
            animation: pulseGlow 2.5s ease-in-out infinite; /* Pulsing animation */
            filter: drop-shadow(0 0 8px rgba(123, 63, 228, 0.6)); /* Glow effect */
        }

        /* Brand Information */
        .brand {
            display: flex;
            flex-direction: column;
        }

        /* Application Name */
        .app-name {
            font-family: 'Inter', sans-serif;
            font-size: 2.2rem;
            font-weight: 700;
            color: var(--lighter);
            margin: 0;
            line-height: 1.2;
            background: linear-gradient(90deg, var(--primary), var(--primary-light)); /* Gradient text */
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 3px 6px rgba(0, 0, 0, 0.25);
        }

        /* Application Tagline */
        .app-tagline {
            font-size: 1rem;
            font-weight: 400;
            color: var(--gray-light);
            margin: 0;
            opacity: 0.85;
        }

        /* Dashboard Layout */
        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(850px, 1fr)); /* Responsive grid */
            gap: 2.5rem;
            justify-content: center;
        }

        /* Video Panel Styling */
        .video-panel {
            background: linear-gradient(135deg, rgba(30, 30, 46, 0.85) 0%, rgba(18, 18, 26, 0.9) 100%); /* Gradient background */
            padding: 2rem;
            border-radius: 24px;
            box-shadow: 0 10px 35px rgba(0, 0, 0, 0.2);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); /* Smooth transition */
            border: 1px solid var(--glass-border);
            animation: fadeInUp 1s ease-out; /* Animation for panel appearance */
            backdrop-filter: blur(12px);
            position: relative;
            overflow: hidden;
        }

        /* Video Panel Background Effect */
        .video-panel::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 25% 25%, rgba(123, 63, 228, 0.15) 0%, transparent 60%); /* Radial glow */
            z-index: -1;
        }

        /* Video Panel Hover Effect */
        .video-panel:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
            border-color: rgba(123, 63, 228, 0.5);
        }

        /* Panel Header */
        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        /* Panel Title */
        .panel-title {
            font-family: 'Inter', sans-serif;
            font-size: 1.8rem;
            font-weight: 600;
            color: var(--lighter);
            margin: 0;
            display: flex;
            align-items: center;
            gap: 0.6rem;
        }

        /* Panel Title Icon */
        .panel-title i {
            color: var(--primary-light);
            font-size: 1.5rem;
            text-shadow: 0 0 10px rgba(123, 63, 228, 0.6);
        }

        /* Canvas Container */
        .canvas-container {
            position: relative;
            width: 100%;
            max-width: 800px;
            height: auto;
            margin: 0 auto 2rem;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.35);
            border: 2px solid rgba(123, 63, 228, 0.35);
            transition: all 0.4s ease;
        }

        /* Canvas Container Hover Effect */
        .canvas-container:hover {
            border-color: rgba(123, 63, 228, 0.7);
            box-shadow: 0 12px 35px rgba(123, 63, 228, 0.25);
        }

        /* Canvas Styling */
        .video-panel canvas {
            display: block;
            width: 100%;
            height: auto;
            border-radius: 12px;
            cursor: pointer;
            background-color: var(--darker);
            transition: all 0.4s ease;
        }

        /* Upload Placeholder */
        .upload-placeholder {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(18, 18, 26, 0.9); /* Semi-transparent background */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: var(--lighter);
            font-size: 1.5rem;
            font-weight: 500;
            text-align: center;
            cursor: pointer;
            transition: all 0.4s ease;
            backdrop-filter: blur(6px);
            border-radius: 12px;
            padding: 2.5rem;
        }

        /* Upload Placeholder Hover Effect */
        .upload-placeholder:hover {
            background: rgba(18, 18, 26, 0.95);
        }

        /* Upload Icon */
        .upload-icon {
            font-size: 3.5rem;
            margin-bottom: 1.8rem;
            color: var(--primary-light);
            text-shadow: 0 0 12px rgba(123, 63, 228, 0.6);
            animation: float 3.5s ease-in-out infinite; /* Floating animation */
        }

        /* Upload Text */
        .upload-text {
            max-width: 85%;
            line-height: 1.7;
        }

        /* Loader Animation */
        .loader {
            display: none;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            border: 6px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 6px solid var(--primary);
            width: 60px;
            height: 60px;
            animation: spin 0.8s linear infinite;
            z-index: 10;
            box-shadow: 0 0 20px rgba(123, 63, 228, 0.6);
        }

        /* Keyframe Animations */
        @keyframes spin {
            0% { transform: translate(-50%, -50%) rotate(0deg); }
            100% { transform: translate(-50%, -50%) rotate(360deg); }
        }

        @keyframes rotateGlow {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-12px); }
            100% { transform: translateY(0px); }
        }

        @keyframes pulseGlow {
            0% { transform: scale(1); filter: drop-shadow(0 0 8px rgba(123, 63, 228, 0.6)); }
            50% { transform: scale(1.08); filter: drop-shadow(0 0 12px rgba(123, 63, 228, 0.8)); }
            100% { transform: scale(1); filter: drop-shadow(0 0 8px rgba(123, 63, 228, 0.6)); }
        }

        /* Control Buttons Container */
        .controls {
            display: flex;
            gap: 1.2rem;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 2rem;
        }

        /* Button Styling */
        .btn {
            padding: 0.9rem 2rem;
            border: none;
            border-radius: 12px;
            font-family: 'Inter', sans-serif;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            gap: 0.6rem;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);
            position: relative;
            overflow: hidden;
            z-index: 1;
        }

        /* Button Shine Effect */
        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 200%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.4s ease;
            z-index: -1;
        }

        .btn:hover::before {
            left: 100%;
        }

        /* Button Icon */
        .btn i {
            font-size: 1.2rem;
        }

        /* Start Button */
        .btn-start {
            background: linear-gradient(135deg, var(--secondary) 0%, var(--secondary-dark) 100%);
            color: var(--lighter);
        }

        .btn-start:hover {
            background: linear-gradient(135deg, var(--secondary-dark) 0%, #008773 100%);
            transform: translateY(-4px);
            box-shadow: 0 10px 25px rgba(0, 212, 180, 0.5);
        }

        /* Stop Button */
        .btn-stop {
            background: linear-gradient(135deg, var(--accent) 0%, var(--accent-dark) 100%);
            color: var(--lighter);
        }

        .btn-stop:hover {
            background: linear-gradient(135deg, var(--accent-dark) 0%, #C93C54 100%);
            transform: translateY(-4px);
            box-shadow: 0 10px 25px rgba(255, 107, 129, 0.5);
        }

        /* Remove Zone Button */
        .btn-remove {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: var(--lighter);
        }

        .btn-remove:hover {
            background: linear-gradient(135deg, var(--primary-dark) 0%, #4A2199 100%);
            transform: translateY(-4px);
            box-shadow: 0 10px 25px rgba(123, 63, 228, 0.5);
        }

        /* Change Video Button */
        .btn-change-video {
            background: linear-gradient(135deg, #3B82F6 0%, #2563EB) 100%;
            color: var(--lighter);
        }

        .btn-change-video:hover {
            background: linear-gradient(135deg, #2563EB 0%, #1E40AF) 100%;
            transform: translateY(-4px);
            box-shadow: 0 10px 25px rgba(59, 130, 246, 0.5);
        }

        /* Export Button */
        .btn-export {
            background: linear-gradient(135deg, var(--warning) 0%, #F59E0B) 100%;
            color: var(--darker);
        }

        .btn-export:hover {
            background: linear-gradient(135deg, #F59E0B 0%, #D97706) 100%;
            transform: translateY(-4px);
            box-shadow: 0 10px 25px rgba(251, 191, 36, 0.5);
        }

        /* Disabled Button */
        .btn:disabled {
            background: var(--gray-light);
            color: var(--gray);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
            opacity: 0.7;
        }

        /* Status Message */
        .status-message {
            margin: 1.2rem 0;
            padding: 1rem 1.5rem;
            background: rgba(123, 63, 228, 0.2);
            border-radius: 12px;
            font-size: 1rem;
            color: var(--lighter);
            text-align: center;
            border-left: 5px solid var(--primary-light);
            animation: fadeIn 0.6s ease;
            backdrop-filter: blur(6px);
            box-shadow: inset 0 0 12px rgba(123, 63, 228, 0.15);
        }

        /* Error Status Message */
        .status-error {
            background: rgba(255, 107, 129, 0.2);
            color: var(--lighter);
            border-left: 5px solid var(--accent);
            box-shadow: inset 0 0 12px rgba(255, 107, 129, 0.15);
        }

        /* Analytics Dashboard */
        .analytics-dashboard {
            margin-top: 2rem;
            padding: 2rem;
            background: linear-gradient(135deg, rgba(30, 30, 46, 0.85) 0%, rgba(18, 18, 26, 0.9) 100%);
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            border: 1px solid var(--glass-border);
            animation: fadeIn 1s ease;
            backdrop-filter: blur(12px);
            position: relative;
            overflow: hidden;
        }

        /* Analytics Dashboard Background Effect */
        .analytics-dashboard::before {
            content: '';
            position: absolute;
            top: -60%;
            right: -60%;
            width: 220%;
            height: 220%;
            background: radial-gradient(circle, rgba(0, 212, 180, 0.1) 0%, transparent 60%);
            z-index: -1;
        }

        /* Analytics Header */
        .analytics-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 2rem;
        }

        /* Analytics Title */
        .analytics-title {
            font-family: 'Inter', sans-serif;
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--lighter);
            margin: 0;
            display: flex;
            align-items: center;
            gap: 0.6rem;
        }

        /* Analytics Title Icon */
        .analytics-title i {
            color: var(--primary-light);
            text-shadow: 0 0 10px rgba(123, 63, 228, 0.6);
        }

        /* Analytics Grid */
        .analytics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 2rem;
        }

        /* Analytics Card */
        .analytics-card {
            background: linear-gradient(135deg, rgba(30, 30, 46, 0.9) 0%, rgba(18, 18, 26, 0.95) 100%);
            border-radius: 20px;
            padding: 1.8rem;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            transition: all 0.4s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            border: 1px solid var(--glass-border);
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(6px);
        }

        /* Analytics Card Background Effect */
        .analytics-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 50% 0%, rgba(123, 63, 228, 0.15) 0%, transparent 60%);
            z-index: -1;
        }

        /* Analytics Card Hover Effect */
        .analytics-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
            border-color: rgba(123, 63, 228, 0.5);
        }

        /* Zone Name */
        .zone-name {
            font-family: 'Inter', sans-serif;
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--lighter);
            margin-bottom: 0.6rem;
            display: flex;
            align-items: center;
            gap: 0.6rem;
            width: 100%;
        }

        /* Zone Name Icon */
        .zone-name i {
            color: var(--primary-light);
            text-shadow: 0 0 10px rgba(123, 63, 228, 0.6);
        }

        /* Zone Count */
        .zone-count {
            font-size: 2.8rem;
            font-weight: 700;
            color: var(--lighter);
            margin-bottom: 1.2rem;
            transition: all 0.6s ease;
            text-shadow: 0 0 12px rgba(123, 63, 228, 0.6);
            background: linear-gradient(90deg, var(--primary), var(--primary-light));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* Zone Visualization Bar */
        .zone-visualization {
            width: 100%;
            height: 200px;
            position: relative;
            background: rgba(0, 0, 0, 0.35);
            border-radius: 16px;
            overflow: hidden;
            margin-bottom: 1.2rem;
            box-shadow: inset 0 0 12px rgba(0, 0, 0, 0.25);
        }

        /* Zone Bar */
        .zone-bar {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 0;
            background: linear-gradient(to top, var(--primary), var(--primary-light));
            transition: height 0.9s cubic-bezier(0.25, 0.8, 0.25, 1);
            display: flex;
            align-items: flex-end;
            justify-content: center;
            padding-bottom: 12px;
            color: white;
            font-weight: 600;
            box-shadow: 0 0 20px rgba(123, 63, 228, 0.4);
        }

        /* Zone Threshold Line */
        .zone-threshold {
            position: absolute;
            left: 0;
            width: 100%;
            height: 3px;
            background-color: var(--accent);
            z-index: 2;
            box-shadow: 0 0 8px rgba(255, 107, 129, 0.6);
        }

        /* Zone Threshold Label */
        .zone-threshold-label {
            position: absolute;
            right: 8px;
            font-size: 0.8rem;
            color: var(--lighter);
            background: rgba(255, 107, 129, 0.9);
            padding: 3px 10px;
            border-radius: 14px;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.15);
        }

        /* Zone Statistics */
        .zone-stats {
            width: 100%;
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
            color: var(--gray-light);
            margin-bottom: 1.2rem;
        }

        /* Zone Stat Item */
        .zone-stat {
            display: flex;
            flex-direction: column;
            align-items: center;
            background: rgba(0, 0, 0, 0.25);
            padding: 0.6rem;
            border-radius: 10px;
            min-width: 70px;
        }

        /* Zone Stat Value */
        .zone-stat-value {
            font-weight: 600;
            color: var(--lighter);
            margin-top: 0.3rem;
        }

        /* Zone History Container */
        .zone-history {
            width: 100%;
            max-height: 140px;
            overflow-y: auto;
            margin-top: 0.6rem;
            border-top: 1px solid var(--glass-border);
            padding-top: 0.6rem;
        }

        /* History Item */
        .history-item {
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
            padding: 0.6rem 0;
            border-bottom: 1px solid var(--glass-border);
            transition: all 0.4s ease;
        }

        /* History Item Hover Effect */
        .history-item:hover {
            background: rgba(123, 63, 228, 0.15);
        }

        /* History Time */
        .history-time {
            color: var(--gray-light);
        }

        /* History Count */
        .history-count {
            font-weight: 600;
            color: var(--lighter);
        }

        /* Footer Section */
        .footer {
            margin-top: 3.5rem;
            padding: 2rem 0;
            text-align: center;
            color: var(--gray-light);
            font-size: 1rem;
            border-top: 1px solid var(--glass-border);
            animation: fadeIn 1.2s ease;
        }

        /* Footer Links Container */
        .footer-links {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin-bottom: 1.2rem;
        }

        /* Footer Link */
        .footer-link {
            color: var(--gray-light);
            text-decoration: none;
            transition: all 0.4s ease;
            position: relative;
        }

        /* Footer Link Underline Effect */
        .footer-link::after {
            content: '';
            position: absolute;
            bottom: -3px;
            left: 0;
            width: 0;
            height: 2px;
            background: var(--primary-light);
            transition: width 0.4s ease;
        }

        /* Footer Link Hover Effect */
        .footer-link:hover {
            color: var(--primary-light);
        }

        .footer-link:hover::after {
            width: 100%;
        }

        /* Footer Copyright */
        .footer-copyright {
            opacity: 0.85;
        }

        /* Developer Information */
        .developer-info {
            font-size: 0.95rem;
            color: var(--gray-light);
            margin-top: 0.5rem;
            opacity: 0.85;
        }

        /* Additional Animations */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideInDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes glow {
            from {
                box-shadow: 0 0 8px rgba(123, 63, 228, 0.6);
            }
            to {
                box-shadow: 0 0 25px rgba(123, 63, 228, 0.9);
            }
        }

        /* Hidden File Input */
        .file-input {
            display: none;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.25);
            border-radius: 12px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--primary-light);
            border-radius: 12px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary);
        }

        /* Responsive Design for Medium Screens */
        @media (max-width: 1200px) {
            .dashboard {
                grid-template-columns: 1fr; /* Single column layout */
            }
            .canvas-container {
                max-width: 100%;
            }
        }

        /* Responsive Design for Small Screens */
        @media (max-width: 768px) {
            .container {
                padding: 2rem;
            }

            .header {
                flex-direction: column;
                text-align: center;
                gap: 1.2rem;
            }

            .controls {
                flex-direction: column;
                align-items: center;
            }

            .btn {
                width: 100%;
                justify-content: center;
            }

            .analytics-grid {
                grid-template-columns: 1fr;
            }

            .canvas-container {
                max-width: 100%;
            }
        }

        /* Responsive Design for Extra Small Screens */
        @media (max-width: 480px) {
            .container {
                padding: 1.2rem;
            }

            .panel-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.6rem;
            }

            .analytics-grid {
                grid-template-columns: 1fr;
            }

            .canvas-container {
                max-width: 100%;
            }

            .upload-placeholder {
                font-size: 1.3rem;
            }

            .upload-icon {
                font-size: 3rem;
            }
        }
    </style>
</head>
<body>
    <!-- Main Container -->
    <div class="container">
        <!-- Header with Logo and Branding -->
        <header class="header">
            <div class="logo-container">
                <!-- Application Logo -->
                <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTYiIGhlaWdodD0iNTYiIHZpZXdCb3g9IjAgMCA1NiA1NiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8Y2lyY2xlIGN4PSIyOCIgY3k9IjI4IiByPSIyNiIgZmlsbD0iIzFCMTgyOCIgZmlsbC1vcGFjaXR5PSIwLjkiLz4KICA8Y2lyY2xlIGN4PSIyOCIgY3k9IjI4IiByPSIyNSIgc3Ryb2tlPSIjN0IzRkU0IiBzdHJva2Utd2lkdGg9IjIiIHN0cm9rZS1vcGFjaXR5PSIwLjk1Ii8+CiAgPHBhdGggZD0iTTI4IDIwQzMxLjMxMzcgMjAgMzQgMTcuNjg2MyAzNCAxNUMzNCAxMi4zMTM3IDMxLjMxMzcgMTAgMjggMTBDMjQuNjg2MyAxMCAyMiAxMS42ODYzIDIyIDE0LjVDMjMuNTY4NSAxNy4xNjg4IDI1LjA5MDIgMTkuMjM1OCAyOCAyMCIgZmlsbD0iIzAwRDRCNCIvPgogIDxwYXRoIGQ9Ik0yNyAzMkgyOS4zTDEwIDI3LjVMMjcuNSAyN0gyOC41TDI5LjUgMjcuNUwyOSAzMkwzMCAzMk0zMi4zIDI3LjVMMzIgMzJMMzMuNSAzMkwzMyAyNy41TTI0LjcgMjcuNUwyNC4zIDMyTDI1LjggMzJMMjYuMyAyNy41IiBzdHJva2U9IiM3QjNGRUQiIHN0cm9rZS13aWR0aD0iMS41IiBzdHJva2UtbGluZWNhcD0icm91bmQiLz4KICA8cGF0aCBkPSJNMjggMjBDMzEuMzEzNyAyMCAzNCAyMi4zMTM3IDM0IDI1QzM0IDI3LjY4NjMgMzEuMzEzNyAzMCAyOCAzMEMyMy41OTIgMzAgMjAgMjYuNDA4IDIwIDIyQzIwIDIyLjExMTEgMjMuMzEzNyAyMCAyOCAyMCIgZmlsbD0iIzAwRDRCNCIvPgogIDxwYXRoIGQ9Ik0yOCAxMi41QzI5LjY1NjYgMTIuNSAzMSAyMS4zNDM0IDMxIDIzQzMxIDI0LjY1NjYgMjkuNjU2NiAyNiAyOCAyNkMyNi4zNDM0IDI2IDI1IDI0LjY1NjYgMjUgMjNDMjUgMjEuMzQzNCAyNi4zNDM0IDEyLjUgMjggMTIuNSIgZmlsbD0iI0ZGNkI4MSIvPgogIDxjaXJjbGUgY3g9IjI4IiBjeT0iMjMiIHI9IjQiIGZpbGw9IiNGRkZGRkYiLz4KPC9zdmc+" alt="VisionTrack Pro Logo" class="logo">
                <div class="brand">
                    <h1 class="app-name">VisionTrack Pro</h1>
                    <p class="app-tagline">Advanced Object Detection System</p>
                </div>
            </div>
        </header>

        <!-- Dashboard with Two Video Streams -->
        <div class="dashboard">
            <!-- Stream 1 Panel -->
            <div class="video-panel">
                <div class="panel-header">
                    <h2 class="panel-title"><i class="fas fa-video"></i> Surveillance Stream 1</h2>
                </div>
                <div class="canvas-container">
                    <!-- Canvas for video display -->
                    <canvas id="canvas1"></canvas>
                    <!-- Placeholder for video upload -->
                    <div id="placeholder1" class="upload-placeholder">
                        <i class="fas fa-cloud-upload-alt upload-icon"></i>
                        <div class="upload-text">Click to upload video or stream</div>
                    </div>
                    <!-- Loader animation during upload -->
                    <div id="loader1" class="loader"></div>
                    <!-- Hidden file input for video upload -->
                    <input type="file" id="video1" name="video1" accept="video/*" class="file-input">
                </div>
                <!-- Control Buttons -->
                <div class="controls">
                    <button onclick="start('1')" class="btn btn-start" disabled>
                        <i class="fas fa-play"></i> Start Detection
                    </button>
                    <button onclick="stop('1')" class="btn btn-stop" disabled>
                        <i class="fas fa-stop"></i> Stop
                    </button>
                    <button onclick="removeLastROI('1')" class="btn btn-remove" disabled>
                        <i class="fas fa-trash-alt"></i> Remove Zone
                    </button>
                    <button onclick="changeVideo('1')" class="btn btn-change-video">
                        <i class="fas fa-upload"></i> Change Video
                    </button>
                </div>
                <!-- Status Message -->
                <p id="status1" class="status-message">Status: Ready to upload video stream</p>
                <!-- Analytics Dashboard for Stream 1 -->
                <div class="analytics-dashboard" id="analytics1">
                    <div class="analytics-header">
                        <h3 class="analytics-title"><i class="fas fa-chart-bar"></i> Detection Analytics</h3>
                        <button onclick="exportZoneData('1')" class="btn btn-export">
                            <i class="fas fa-file-pdf"></i> Export Zone Data
                        </button>
                    </div>
                    <div id="analytics-grid1" class="analytics-grid"></div>
                </div>
            </div>

            <!-- Stream 2 Panel -->
            <div class="video-panel">
                <div class="panel-header">
                    <h2 class="panel-title"><i class="fas fa-video"></i> Surveillance Stream 2</h2>
                </div>
                <div class="canvas-container">
                    <canvas id="canvas2"></canvas>
                    <div id="placeholder2" class="upload-placeholder">
                        <i class="fas fa-cloud-upload-alt upload-icon"></i>
                        <div class="upload-text">Click to upload video or stream</div>
                    </div>
                    <div id="loader2" class="loader"></div>
                    <input type="file" id="video2" name="video2" accept="video/*" class="file-input">
                </div>
                <div class="controls">
                    <button onclick="start('2')" class="btn btn-start" disabled>
                        <i class="fas fa-play"></i> Start Detection
                    </button>
                    <button onclick="stop('2')" class="btn btn-stop" disabled>
                        <i class="fas fa-stop"></i> Stop
                    </button>
                    <button onclick="removeLastROI('2')" class="btn btn-remove" disabled>
                        <i class="fas fa-trash-alt"></i> Remove Zone
                    </button>
                    <button onclick="changeVideo('2')" class="btn btn-change-video">
                        <i class="fas fa-upload"></i> Change Video
                    </button>
                </div>
                <p id="status2" class="status-message">Status: Ready to upload video stream</p>
                <div class="analytics-dashboard" id="analytics2">
                    <div class="analytics-header">
                        <h3 class="analytics-title"><i class="fas fa-chart-bar"></i> Detection Analytics</h3>
                        <button onclick="exportZoneData('2')" class="btn btn-export">
                            <i class="fas fa-file-pdf"></i> Export Zone Data
                        </button>
                    </div>
                    <div id="analytics-grid2" class="analytics-grid"></div>
                </div>
            </div>
        </div>

        <!-- Footer Section -->
        <footer class="footer">
            <div class="footer-links">
                <a href="#" class="footer-link">Privacy Policy</a>
                <a href="#" class="footer-link">Terms of Service</a>
                <a href="#" class="footer-link">Documentation</a>
                <a href="#" class="footer-link">Support</a>
            </div>
            <p class="footer-copyright">© 2025 VisionTrack Pro. All rights reserved.</p>
            <p class="developer-info">Designed & Developed by Wassim Hfaiedh</p>
        </footer>
    </div>

    <!-- JavaScript Section -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.5.1/socket.io.js"></script>
    <script>
        // Initialize jsPDF for PDF generation
        const { jsPDF } = window.jspdf;

        // Initialize SocketIO client
        const socket = io();

        // Store frame dimensions for each processor
        const frameDimensions = {
            '1': { width: 800, height: 450 },
            '2': { width: 800, height: 450 }
        };

        // Track processor states
        const processors = {};

        // Store maximum counts for analytics visualization
        const maxCounts = {
            '1': {},
            '2': {}
        };

        // Store zone history for analytics
        const zoneHistory = {
            '1': {},
            '2': {}
        };

        // Handle SocketIO connection
        socket.on('connect', () => {
            console.log('Connected to SocketIO server');
            updateStatus('1', 'Connected to detection server');
            updateStatus('2', 'Connected to detection server');
        });

        // Handle SocketIO disconnection
        socket.on('disconnect', () => {
            console.log('Disconnected from SocketIO server');
            updateStatus('1', 'Disconnected from server', true);
            updateStatus('2', 'Disconnected from server', true);
        });

        // Update canvas dimensions for processor 1
        socket.on('frame_dimensions_1', (data) => {
            frameDimensions['1'] = { width: data.width, height: data.height };
            const canvas = document.getElementById('canvas1');
            canvas.width = data.width;
            canvas.height = data.height;
            console.log(`Received dimensions for processor 1: ${data.width}x${data.height}`);
        });

        // Update canvas dimensions for processor 2
        socket.on('frame_dimensions_2', (data) => {
            frameDimensions['2'] = { width: data.width, height: data.height };
            const canvas = document.getElementById('canvas2');
            canvas.width = data.width;
            canvas.height = data.height;
            console.log(`Received dimensions for processor 2: ${data.width}x${data.height}`);
        });

        // Update status message for a processor
        function updateStatus(processorId, message, isError = false) {
            const statusElement = document.getElementById(`status${processorId}`);
            if (statusElement) {
                statusElement.textContent = `Status: ${message}`;
                statusElement.className = isError ? 'status-message status-error' : 'status-message';
            } else {
                console.error(`Status element for processor ${processorId} not found`);
            }
        }

        // Create an analytics card for a zone
        function createZoneCard(processorId, zoneIndex, count = 0) {
            const grid = document.getElementById(`analytics-grid${processorId}`);
            const card = document.createElement('div');
            card.className = 'analytics-card animate__animated animate__fadeIn';
            card.id = `zone-${processorId}-${zoneIndex}`;

            if (!zoneHistory[processorId][zoneIndex]) {
                zoneHistory[processorId][zoneIndex] = [];
            }

            const now = new Date();
            const timeString = now.toLocaleTimeString();
            zoneHistory[processorId][zoneIndex].push({
                time: timeString,
                count: count
            });

            if (zoneHistory[processorId][zoneIndex].length > 5) {
                zoneHistory[processorId][zoneIndex].shift();
            }

            const threshold = Math.floor(Math.random() * 8) + 3;
            maxCounts[processorId][zoneIndex] = Math.max(threshold * 2, 10);

            const avgCount = zoneHistory[processorId][zoneIndex].length > 0 ?
                Math.round(zoneHistory[processorId][zoneIndex].reduce((sum, item) => sum + item.count, 0) /
                zoneHistory[processorId][zoneIndex].length) : 0;

            card.innerHTML = `
                <div class="zone-name">
                    <i class="fas fa-map-marker-alt"></i> Zone ${zoneIndex + 1}
                </div>
                <div class="zone-count">${count}</div>
                <div class="zone-visualization">
                    <div class="zone-threshold" style="bottom: ${(threshold / maxCounts[processorId][zoneIndex]) * 100}%">
                        <span class="zone-threshold-label">Alert: ${threshold}</span>
                    </div>
                    <div class="zone-bar" style="height: ${(count / maxCounts[processorId][zoneIndex]) * 100}%">${count}</div>
                </div>
                <div class="zone-stats">
                    <div class="zone-stat">
                        <span>Max</span>
                        <span class="zone-stat-value">${maxCounts[processorId][zoneIndex]}</span>
                    </div>
                    <div class="zone-stat">
                        <span>Avg</span>
                        <span class="zone-stat-value">${avgCount}</span>
                    </div>
                    <div class="zone-stat">
                        <span>Threshold</span>
                        <span class="zone-stat-value">${threshold}</span>
                    </div>
                </div>
                <div class="zone-history">
                    ${zoneHistory[processorId][zoneIndex].map(item => `
                        <div class="history-item">
                            <span class="history-time">${item.time}</span>
                            <span class="history-count">${item.count}</span>
                        </div>
                    `).join('')}
                </div>
            `;

            grid.appendChild(card);
        }

        // Update an existing analytics card
        function updateZoneCard(processorId, zoneIndex, count) {
            let card = document.getElementById(`zone-${processorId}-${zoneIndex}`);

            if (!card) {
                createZoneCard(processorId, zoneIndex, count);
                return;
            }

            if (count > maxCounts[processorId][zoneIndex]) {
                maxCounts[processorId][zoneIndex] = count * 1.2;
                const thresholdElement = card.querySelector('.zone-threshold');
                const threshold = parseInt(thresholdElement.style.bottom) / 100 * maxCounts[processorId][zoneIndex];
                thresholdElement.style.bottom = `${(threshold / maxCounts[processorId][zoneIndex]) * 100}%`;
                thresholdElement.querySelector('.zone-threshold-label').textContent = `Alert: ${Math.round(threshold)}`;
            }

            const now = new Date();
            const timeString = now.toLocaleTimeString();
            if (!zoneHistory[processorId][zoneIndex]) {
                zoneHistory[processorId][zoneIndex] = [];
            }
            zoneHistory[processorId][zoneIndex].push({
                time: timeString,
                count: count
            });

            if (zoneHistory[processorId][zoneIndex].length > 5) {
                zoneHistory[processorId][zoneIndex].shift();
            }

            const avgCount = zoneHistory[processorId][zoneIndex].length > 0 ?
                Math.round(zoneHistory[processorId][zoneIndex].reduce((sum, item) => sum + item.count, 0) /
                zoneHistory[processorId][zoneIndex].length) : 0;

            const countElement = card.querySelector('.zone-count');
            const barElement = card.querySelector('.zone-bar');
            const maxElement = card.querySelector('.zone-stat:nth-child(1) .zone-stat-value');
            const avgElement = card.querySelector('.zone-stat:nth-child(2) .zone-stat-value');
            const historyContainer = card.querySelector('.zone-history');

            if (parseInt(countElement.textContent) < count) {
                barElement.classList.add('animate__animated', 'animate__pulse');
                setTimeout(() => {
                    barElement.classList.remove('animate__animated', 'animate__pulse');
                }, 500);
            }

            countElement.textContent = count;
            barElement.textContent = count;
            barElement.style.height = `${(count / maxCounts[processorId][zoneIndex]) * 100}%`;
            maxElement.textContent = maxCounts[processorId][zoneIndex];
            avgElement.textContent = avgCount;

            historyContainer.innerHTML = zoneHistory[processorId][zoneIndex].map(item => `
                <div class="history-item">
                    <span class="history-time">${item.time}</span>
                    <span class="history-count">${item.count}</span>
                </div>
            `).join('');

            const threshold = parseInt(card.querySelector('.zone-threshold-label').textContent.split(': ')[1]);
            if (count >= threshold) {
                barElement.style.background = 'linear-gradient(to top, var(--accent), var(--accent-dark))';
                card.style.boxShadow = '0 0 20px rgba(255, 107, 129, 0.6)';
                setTimeout(() => {
                    card.style.boxShadow = '0 10px 25px rgba(0, 0, 0, 0.2)';
                }, 1000);
            } else {
                barElement.style.background = 'linear-gradient(to top, var(--primary), var(--primary-light))';
            }
        }

        // Export zone data as PDF
        async function exportZoneData(processorId) {
            try {
                updateStatus(processorId, 'Preparing export...');

                const response = await fetch(`/export_zone_data/${processorId}`);
                if (!response.ok) {
                    throw new Error(`Failed to fetch zone data: ${response.status} ${response.statusText}`);
                }
                const data = await response.json();

                const doc = new jsPDF();
                const now = new Date();
                const dateString = now.toLocaleDateString();
                const timeString = now.toLocaleTimeString();

                // Add title and timestamp
                doc.setFontSize(18);
                doc.setTextColor(40);
                doc.text(`Zone Analytics Report - Stream ${processorId}`, 105, 15, { align: 'center' });

                doc.setFontSize(12);
                doc.setTextColor(100);
                doc.text(`Generated on ${dateString} at ${timeString}`, 105, 22, { align: 'center' });

                // Add logo to PDF
                try {
                    const logoData = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTYiIGhlaWdodD0iNTYiIHZpZXdCb3g9IjAgMCA1NiA1NiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8Y2lyY2xlIGN4PSIyOCIgY3k9IjI4IiByPSIyNiIgZmlsbD0iIzFCMTgyOCIgZmlsbC1vcGFjaXR5PSIwLjkiLz4KICA8Y2lyY2xlIGN4PSIyOCIgY3k9IjI4IiByPSIyNSIgc3Ryb2tlPSIjN0IzRkU0IiBzdHJva2Utd2lkdGg9IjIiIHN0cm9rZS1vcGFjaXR5PSIwLjk1Ii8+CiAgPHBhdGggZD0iTTI4IDIwQzMxLjMxMzcgMjAgMzQgMTcuNjg2MyAzNCAxNUMzNCAxMi4zMTM3IDMxLjMxMzcgMTAgMjggMTBDMjQuNjg2MyAxMCAyMiAxMS42ODYzIDIyIDE0LjVDMjMuNTY4NSAxNy4xNjg4IDI1LjA5MDIgMTkuMjM1OCAyOCAyMCIgZmlsbD0iIzAwRDRCNCIvPgogIDxwYXRoIGQ9Ik0yNyAzMkgyOS4zTDEwIDI3LjVMMjcuNSAyN0gyOC41TDI5LjUgMjcuNUwyOSAzMkwzMCAzMk0zMi4zIDI3LjVMMzIgVzJMMzMuNSAzMkwzMyAyNy41TTI0LjcgMjcuNUwyNC4zIDMyTDI1LjggMzJMMjYuMyAyNy41IiBzdHJva2U9IiM3QjNGRUQiIHN0cm9rZS13aWR0aD0iMS41IiBzdHJva2UtbGluZWNhcD0icm91bmQiLz4KICA8cGF0aCBkPSJNMjggMjBDMzEuMzEzNyAyMCAzNCAyMi4zMTM3IDM0IDI1QzM0IDI3LjY4NjMgMzEuMzEzNyAzMCAyOCAzMEMyMy41OTIgMzAgMjAgMjYuNDA4IDIwIDIyQzIwIDIyLjExMTEgMjMuMzEzNyAyMCAyOCAyMCIgZmlsbD0iIzAwRDRCNCIvPgogIDxwYXRoIGQ9Ik0yOCAxMi41QzI5LjY1NjYgMTIuNSAzMSAyMS4zNDM0IDMxIDIzQzMxIDI0LjY1NjYgMjkuNjU2NiAyNiAyOCAyNkMyNi4zNDM0IDI2IDI1IDI0LjY1NjYgMjUgMjNDMjUgMjEuMzQzNCAyNi4zNDM0IDEyLjUgMjggMTIuNSIgZmlsbD0iI0ZGNkI4MSIvPgogIDxjaXJjbGUgY3g9IjI4IiBjeT0iMjMiIHI9IjQiIGZpbGw9IiNGRkZGRkYiLz4KPC9zdmc+';
                    doc.addImage(logoData, 'PNG', 180, 10, 20, 20);
                } catch (e) {
                    console.warn('Could not add logo to PDF:', e);
                }

                // Zone Summary Table
                doc.setFontSize(14);
                doc.setTextColor(40);
                doc.text('Zone Summary', 14, 40);

                const summaryHeaders = [["Zone", "Current Count", "Last Update"]];
                const summaryData = data.zones.map(zone => [
                    `Zone ${zone.zone}`,
                    zone.latest_count.toString(),
                    zone.latest_time
                ]);

                if (summaryData.length === 0) {
                    summaryData.push(["No zones defined", "", ""]);
                }

                doc.autoTable({
                    startY: 45,
                    head: summaryHeaders,
                    body: summaryData,
                    theme: 'grid',
                    headStyles: {
                        fillColor: [123, 63, 228],
                        textColor: 255
                    },
                    alternateRowStyles: {
                        fillColor: [241, 245, 249]
                    }
                });

                // Detailed Zone History
                doc.setFontSize(14);
                doc.setTextColor(40);
                doc.text('Detailed Zone History', 14, doc.autoTable.previous.finalY + 20);

                data.zones.forEach((zone, index) => {
                    const zoneHeaders = [[`Zone ${zone.zone} - Time`, `Zone ${zone.zone} - Count`]];
                    const zoneData = zone.history.map(item => [item.time, item.count.toString()]);

                    if (zoneData.length === 0) {
                        zoneData.push(["No history available", ""]);
                    }

                    doc.autoTable({
                        startY: doc.autoTable.previous.finalY + 25,
                        head: zoneHeaders,
                        body: zoneData,
                        theme: 'grid',
                        headStyles: {
                            fillColor: [0, 212, 180],
                            textColor: 255
                        },
                        alternateRowStyles: {
                            fillColor: [236, 253, 245]
                        }
                    });
                });

                // Detection Classes by Zone
                doc.setFontSize(14);
                doc.setTextColor(40);
                doc.text('Detection Classes by Zone', 14, doc.autoTable.previous.finalY + 20);

                data.zones.forEach((zone, index) => {
                    const classHeaders = [[`Zone ${zone.zone} - Class`, 'Count']];
                    const classData = zone.classes ?
                        Object.entries(zone.classes).map(([className, count]) => [className, count.toString()]) :
                        [["No class data available", ""]];

                    doc.autoTable({
                        startY: doc.autoTable.previous.finalY + 25,
                        head: classHeaders,
                        body: classData,
                        theme: 'grid',
                        headStyles: {
                            fillColor: [123, 63, 228],
                            textColor: 255
                        },
                        alternateRowStyles: {
                            fillColor: [241, 245, 249]
                        }
                    });
                });

                // Save the PDF
                doc.save(`Stream_${processorId}_Zone_Analytics_${dateString.replace(/\//g, '-')}.pdf`);
                updateStatus(processorId, 'Export completed successfully');

            } catch (error) {
                console.error('Error exporting zone data:', error);
                updateStatus(processorId, `Error exporting data: ${error.message}`, true);
            }
        }

        // Handle video change
        function changeVideo(processorId) {
            const fileInput = document.getElementById(`video${processorId}`);
            const placeholder = document.getElementById(`placeholder${processorId}`);
            const canvas = document.getElementById(`canvas${processorId}`);
            const context = canvas.getContext('2d');

            if (processors[processorId]) {
                stop(processorId); // Stop current detection
                document.getElementById(`analytics-grid${processorId}`).innerHTML = ''; // Clear analytics
                maxCounts[processorId] = {};
                zoneHistory[processorId] = {};
                processors[processorId] = false; // Reset processor state

                // Reset canvas
                context.fillStyle = '#12121A';
                context.fillRect(0, 0, canvas.width, canvas.height);
                context.fillStyle = '#FFFFFF';
                context.font = '28px Inter';
                context.textAlign = 'center';
                context.textBaseline = 'middle';
                context.fillText('Upload your video', canvas.width / 2, canvas.height / 2);
            }

            placeholder.style.display = 'flex'; // Show placeholder
            fileInput.click();
        }

        // Start video detection
        function start(processorId) {
            if (processors[processorId]) {
                console.log(`Starting video for processor ${processorId}`);
                socket.emit('start', { processor_id: processorId });
                updateStatus(processorId, 'Detection started');
            } else {
                updateStatus(processorId, 'Please upload a video first', true);
            }
        }

        // Stop video detection
        function stop(processorId) {
            if (processors[processorId]) {
                console.log(`Stopping video for processor ${processorId}`);
                socket.emit('stop', { processor_id: processorId });
                updateStatus(processorId, 'Detection stopped');
            }
        }

        // Remove the last ROI
        function removeLastROI(processorId) {
            if (processors[processorId]) {
                console.log(`Removing last ROI for processor ${processorId}`);
                socket.emit('remove_last_roi', { processor_id: processorId });
                updateStatus(processorId, 'Last zone removed');

                const grid = document.getElementById(`analytics-grid${processorId}`);
                const cards = grid.querySelectorAll('.analytics-card');
                if (cards.length > 0) {
                    const lastCard = cards[cards.length - 1];
                    const zoneIndex = parseInt(lastCard.id.split('-').pop());

                    if (zoneHistory[processorId][zoneIndex]) {
                        delete zoneHistory[processorId][zoneIndex];
                    }

                    lastCard.classList.add('animate__animated', 'animate__fadeOut');
                    setTimeout(() => {
                        lastCard.remove();
                    }, 500);
                }
            }
        }

        // Initialize event listeners for each processor
        ['1', '2'].forEach(processorId => {
            const canvas = document.getElementById(`canvas${processorId}`);
            const placeholder = document.getElementById(`placeholder${processorId}`);
            const loader = document.getElementById(`loader${processorId}`);
            const fileInput = document.getElementById(`video${processorId}`);
            const buttons = document.querySelectorAll(`.video-panel:nth-child(${parseInt(processorId)}) .btn`);
            const context = canvas.getContext('2d');

            // Initialize canvas with placeholder text
            context.fillStyle = '#12121A';
            context.fillRect(0, 0, canvas.width, canvas.height);
            context.fillStyle = '#FFFFFF';
            context.font = '28px Inter';
            context.textAlign = 'center';
            context.textBaseline = 'middle';
            context.fillText('Upload your video', canvas.width / 2, canvas.height / 2);

            // Trigger file input on placeholder click
            placeholder.addEventListener('click', () => {
                console.log(`Canvas clicked for processor ${processorId}, triggering file input`);
                fileInput.click();
            });

            // Handle video file upload
            fileInput.addEventListener('change', async (e) => {
                const file = e.target.files[0];
                if (!file) {
                    console.log(`No file selected for processor ${processorId}`);
                    updateStatus(processorId, 'No file selected', true);
                    return;
                }

                console.log(`File selected for processor ${processorId}: ${file.name}`);
                const formData = new FormData();
                formData.append(`video${processorId}`, file);

                placeholder.style.display = 'none';
                loader.style.display = 'block';
                buttons.forEach(btn => btn.disabled = true);

                updateStatus(processorId, 'Uploading video...');

                try {
                    console.log(`Uploading video for processor ${processorId} to /upload/${processorId}`);
                    const response = await fetch(`/upload/${processorId}`, {
                        method: 'POST',
                        body: formData
                    });

                    const result = await response.json();
                    console.log(`Upload response for processor ${processorId}:`, result);

                    if (response.ok) {
                        processors[processorId] = true;
                        updateStatus(processorId, 'Left-click to add ROI points, right-click to complete, click and drag to move ROI');
                        buttons.forEach(btn => btn.disabled = false);
                    } else {
                        updateStatus(processorId, result.message || result.error || 'Upload failed', true);
                        placeholder.style.display = 'flex';
                        buttons.forEach(btn => btn.disabled = true);
                    }
                } catch (error) {
                    console.error(`Upload error for processor ${processorId}:`, error);
                    updateStatus(processorId, `Error uploading video: ${error.message}`, true);
                    placeholder.style.display = 'flex';
                    buttons.forEach(btn => btn.disabled = true);
                } finally {
                    loader.style.display = 'none';
                }
            });
        });

        // Initialize canvas and context for each processor
        const canvases = {
            '1': document.getElementById('canvas1'),
            '2': document.getElementById('canvas2')
        };

        const contexts = {
            '1': canvases['1'].getContext('2d'),
            '2': canvases['2'].getContext('2d')
        };

        // Event listeners for canvas interactions
        ['1', '2'].forEach(processorId => {
            let isDragging = false;

            // Handle video frame updates
            socket.on(`video_frame_${processorId}`, (data) => {
                const img = new Image();
                img.src = `data:image/jpeg;base64,${data.frame}`;
                img.onload = () => {
                    contexts[processorId].drawImage(img, 0, 0, canvases[processorId].width, canvases[processorId].height);
                };
            });

            // Handle status updates
            socket.on(`update_status_${processorId}`, (data) => {
                updateStatus(processorId, data.message);
            });

            // Handle count updates for analytics
            socket.on(`update_counts_${processorId}`, (data) => {
                if (Object.keys(data.counts).length === 0) {
                    document.getElementById(`analytics-grid${processorId}`).innerHTML = '';
                    maxCounts[processorId] = {};
                    zoneHistory[processorId] = {};
                    return;
                }

                for (const [zone, count] of Object.entries(data.counts)) {
                    updateZoneCard(processorId, parseInt(zone), count);
                }

                const grid = document.getElementById(`analytics-grid${processorId}`);
                const cards = grid.querySelectorAll('.analytics-card');
                cards.forEach(card => {
                    const zoneIndex = parseInt(card.id.split('-').pop());
                    if (!data.counts.hasOwnProperty(zoneIndex)) {
                        if (zoneHistory[processorId][zoneIndex]) {
                            delete zoneHistory[processorId][zoneIndex];
                        }

                        card.classList.add('animate__animated', 'animate__fadeOut');
                        setTimeout(() => {
                            card.remove();
                        }, 500);
                    }
                });
            });

            // Handle mouse down for adding ROI points
            canvases[processorId].addEventListener('mousedown', (e) => {
                if (e.button === 0 && processors[processorId]) {
                    const rect = canvases[processorId].getBoundingClientRect();
                    const scaleX = frameDimensions[processorId].width / rect.width;
                    const scaleY = frameDimensions[processorId].height / rect.height;
                    const x = (e.clientX - rect.left) * scaleX;
                    const y = (e.clientY - rect.top) * scaleY;

                    console.log(`Left click at canvas (${e.clientX - rect.left}, ${e.clientY - rect.top}), mapped to (${x}, ${y}) for processor ${processorId}`);
                    socket.emit('add_roi_point', { processor_id: processorId, x, y });
                    isDragging = true;
                }
            });

            // Handle mouse movement for dragging ROIs
            canvases[processorId].addEventListener('mousemove', (e) => {
                if (isDragging && processors[processorId]) {
                    const rect = canvases[processorId].getBoundingClientRect();
                    const scaleX = frameDimensions[processorId].width / rect.width;
                    const scaleY = frameDimensions[processorId].height / rect.height;
                    const x = (e.clientX - rect.left) * scaleX;
                    const y = (e.clientY - rect.top) * scaleY;

                    socket.emit('move_roi', { processor_id: processorId, x, y });
                }
            });

            // Handle mouse up to stop dragging
            canvases[processorId].addEventListener('mouseup', (e) => {
                if (e.button === 0 && processors[processorId]) {
                    isDragging = false;
                    socket.emit('stop_moving_roi', { processor_id: processorId });
                }
            });

            // Handle right-click to complete ROI
            canvases[processorId].addEventListener('contextmenu', (e) => {
                e.preventDefault();
                if (e.button === 2 && processors[processorId]) {
                    console.log(`Right click to complete ROI for processor ${processorId}`);
                    socket.emit('complete_roi', { processor_id: processorId });
                }
            });
        });
    </script>
</body>
</html>